<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity3">
<head>
    <meta charset="UTF-8">
    <title>Register</title>
    <link rel="stylesheet" href="/css/base.css">
</head>
<body>
<div class="register_container">
    <div class="wr">
        <form onsubmit="return false">
            <table>
                <tr>
                    <td><label>ID</label></td>
                    <td><input type="text" id="id"></td>
                    <td><input type="submit" id="confirm" value="Confirm"></td>
                </tr>
                <tr>
                    <td><label>PW</label></td>
                    <td><input type="password" id="pwd"></td>
                </tr>
                <tr>
                    <td><label>Email</label></td>
                    <td><input type="text" id="email"></td>
                </tr>
                <tr>
                    <td colspan="4" style="text-align: center"><input id="signup" type="submit" value="Sign Up"></td>
                </tr>
            </table>
        </form>
    </div>
</div>

<script th:src="@{/js/jquery.min.js}"></script>
<script>
    var n = 0;

    $('#confirm').click(function () {
        var idData = JSON.stringify({
            id: $('#id').val()
        });
        $.ajax({
            async: true,
            url: "/register/confirm",
            type: "POST",
            data: idData,
            contentType: "application/json",
            dataType: "json",
            success: function () {
                alert('사용 가능한 아이디 입니다.');
                n = 1;
            },
            error: function () {
                alert('이미 사용중인 아이디 입니다.');
            }
        });
    });
    $('#signup').click(function () {

        if(n===0){
            alert('아이디 중복체크를 해주세요');
        } else if (n===1){
            var userData = JSON.stringify({
                id: $('#id').val(),
                pwd: $('#pwd').val(),
                email: $('#email').val()
            });
            $.ajax({
                url: "/register",
                type: "POST",
                data: userData,
                contentType: "application/json",
                dataType: "json",
                success: function () {
                    location.href = '/login';
                },
                error: function () {
                    alert('Nope!');
                }
            });

        }
    });
</script>
</body>
</html>